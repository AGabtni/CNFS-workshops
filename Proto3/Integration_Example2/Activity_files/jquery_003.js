
(function($){var cache={};function _tmpl(str,data){var fn=cache[str]=cache[str]||new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+
str.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")
+"');}return p.join('');");return data?fn(data):fn;}
function _c(){if(window.console&&window.console.log){window.console.log(arguments);}}
$.fn.iterTriggerHandler=function(msg){return this.each(function(){$(this).triggerHandler(msg);});};$.fn.wordQuiz=function(options){return this.each(function(){if($(this).data('word-quiz')==undefined){$.data(this,'word-quiz',new $.fn.wordQuiz.Quiz(this,options));}else{_c('Wordquiz was already created on this element.');}});};$.fn.wordQuiz.Quiz=function(container,options){this.options=options=$.extend({},$.fn.wordQuiz.defaults,options);this.element=container;$.extend(this,$.fn.wordQuiz._score_keeper);this.init();$.extend(this,$.fn.wordQuiz.messenger);var $c=$(container);$(options.d_link_html).prependTo(container).find('a').bind('click submit',function(e){e.preventDefault();$c.find('.subscriber').iterTriggerHandler('reset-html');});$c.find(options.feedback_selector).wordFeedback();$c.find(options.question_selector).wordQuestion(options);$c.iterTriggerHandler('get-score');var broadcaster_button_options=$.extend({},options,{'context':this.element});$c.find(this.options.broadcaster_button_selector).each(function(){$.data(this,'broadcaster-button',new $.fn.wordQuiz.BroadcasterButton(this,broadcaster_button_options));});};$.fn.wordQuiz.messenger={_tmplMessage:function(msg,data){var _msg={};for(var i in msg){if(typeof msg[i]==='string'){_msg[i]=_tmpl(msg[i],data);}}
this.addMessage(_msg);},addMessage:function(msg){}};$.fn.wordQuiz._score_keeper={init:function(){var $e=$(this.element),_scoreTimer,that=this;$e.bind('request-rescore',function(){clearTimeout(_scoreTimer);_scoreTimer=setTimeout(function(){$e.iterTriggerHandler('get-score');},200);});$e.bind('get-score',{},function(){var score=that.getScore();$(this).data('score',score);that.updateScoreboard();if(score.total==score.correct){that._tmplMessage(that.options.word_quiz_finished_message,score);}});$e.bind('check-answers',{},function(){$(this).triggerHandler('get-score');that._tmplMessage(that.options.word_quiz_check_answers_message,$(this).data('score'));});},getScore:function(){var score_obj={correct:0,total:0};$(this.element).find('.scored-item').each(function(){var data=$(this).data();var type=data.type;score_obj.correct+=data.correct||0;score_obj.total+=data.total||1;if(type){if(!score_obj[type+'_correct']){score_obj[type+'_correct']=0;}
if(!score_obj[type+'_total']){score_obj[type+'_total']=0;}
score_obj[type+'_correct']+=data.correct||0;score_obj[type+'_total']+=data.total||1;}});return score_obj;},propertyNameToScoreboardClassName:function(pn){return this.options.scoreboard_selector+'-'+(pn.split('_').join('-'));},updateScoreboard:function(){var $e=$(this.element),score_obj=$e.data('score');for(var i in score_obj){if(score_obj.hasOwnProperty(i)){var className=this.propertyNameToScoreboardClassName(i);var score=score_obj[i]||0;$e.find(className).html(score);}}}};$.fn.wordQuiz.defaults={word_quiz_finished_message:{title:'Good job!',text:'You have completed the quiz.'},word_quiz_check_answers_message:{title:'Score',text:'<%=correct%>/<%=total%>'},question_selector:'.wordquestion',feedback_selector:'.wordfeedback',scoreboard_selector:'.wordscoreboard',broadcaster_button_selector:'button',broadcaster_button_message_css_class_stub:'wordquiz-',d_link_html:'<div class="ui-helper-hidden-accessible"><a href="#">Plain HTML</a> '+'This exercise uses JavaScript to display and hide content. '+'If you wish to see the plain HTML of the exercise, please '+'click the "Plain HTML" link.</div>',correct_icon_html:'<strong style="color:#009900;">Correct</strong> ',incorrect_icon_html:'<strong style="color:#990000;">Incorrect</strong> ',type:'find'};$.fn.wordQuiz.BroadcasterButton=function(container,options){this.element=container;this.context=options.context;this.selector_stub=options.broadcaster_button_message_css_class_stub;this.messages=[];this.init=function(){this.messages=this.getMsgsFromCssClass();var that=this;$(this.element).bind('click submit',function(){that.broadcast();});};this.getMsgsFromCssClass=function(){var classes=$(this.element).attr('class').split(' ');var msgs=[];for(var i=0;i<classes.length;i+=1){var this_class=classes[i];if(this_class.indexOf(this.selector_stub)===0){msgs.push(this_class.substr(this.selector_stub.length));}}
return msgs;};this.broadcast=function(){var msg_len=this.messages.length;for(var i=0;i<msg_len;i++){var msg=this.messages[i];$(this.context).find('.subscriber').iterTriggerHandler(msg);$(this.context).iterTriggerHandler(msg);_c('Broadcast: '+msg);}};this.init();};$.fn.wordFeedback=function(options){var args=Array.prototype.slice.call(arguments,1);return this.each(function(){$.data(this,'word-quiz-feedback',new $.fn.wordFeedback.Feedback(this,options));});};$.fn.wordFeedback.Feedback=function(container,options){this.options=options=$.extend({},$.fn.wordFeedback.defaults,options);this.element=container;$.extend(this,$.fn.wordFeedback.Feedback.animations);$(this.element).addClass('default-feedback');this.init=function(){var that=this;$(this.element).hide().addClass('subscriber').bind('show-feedback reset-html',function(){that.show();}).bind('hide-feedback',function(){that.hide();}).bind('restart',function(){that.hide();});};this.init();};$.fn.wordFeedback.Feedback.animations={hide:function(){$(this.element).slideUp();},show:function(){$(this.element).slideDown();}};$.fn.wordFeedback.Feedback.defaults={};$.fn.wordQuestion=function(options){return this.each(function(){if($(this).data('word-quiz-question')==undefined){$.data(this,'word-quiz-question',new $.fn.wordQuestion.Question(this,options));}else{_c('wordQuestion has already been called on this object.');}});};$.fn.wordQuestion.Question=function(container,options){this.options=options=$.extend({},$.fn.wordQuestion.Question.defaults,options);this.element=container;$.extend(this,$.fn.wordQuestion.types.base);this._init();};$.fn.wordQuestion.defaults={};$.fn.wordQuestion.latest_id=-1;$.fn.wordQuestion._getLatestId=function(){$.fn.wordQuestion.latest_id+=1;return $.fn.wordQuestion.latest_id;};$.fn.wordQuestion.types={base:{_init:function(){var $e=$(this.element);$e.data('html',$e.html()).data('correct',0).data('type',this.options.type);this.subscribe();if($.fn.wordQuestion.types.hasOwnProperty(this.options.type)){$.extend(this,$.fn.wordQuestion.types[this.options.type]);}else{_c('wordQuestion: Attempting to extend a question, but '+this.options.type+' does not exist.');}
if(typeof this.init==='function'){this.init();}},getCorrectAnswers:function(el){return $(el).find('ins');},getIncorrectAnswers:function(){return $(el).find('del');},subscribe:function(){var that=this;var $e=$(this.element);$e.addClass('scored-item');$e.addClass('subscriber');$e.bind('restart',function(ev){that.restart();});$e.bind('check-answers',function(ev){that.checkAnswers();});$e.bind('reset-html',function(ev){that.resetHTML();});},restart:function(){$(this.element).data('correct',0);_c('restart(), not overridden.');},checkAnswers:function(){_c('checkAnswers(), not overridden.');},doTemplate:function(template){if(!$.isFunction(template)){_c('Consider pre-compiling this template, using _tmpl().',template);template=_tmpl(template);}
var $e=$(this.element);$e.html(template.call(this,$.extend({},$e.data(),this.options)));},requestRescore:function(){$(this.element).trigger('request-rescore');},resetHTML:function(callback){this.doTemplate('<%=html%>');}},type:{templates:{correct:_tmpl('<%=correct_icon_html%><%=correct_text%>'),incorrect:_tmpl('<%=incorrect_icon_html%><ins><%=correct_text%></ins> Votre réponse était : <%=user_response%>.'),textbox:_tmpl('<input type="text" value="<%=user_response%>" size="<%=correct_text_length%>" />')},init:function(){console.log(this.getCorrectAnswers(this.element));var ins_text=$(this.element).find('ins').eq(0).text();var $e=$(this.element);$e.data('correct_text',ins_text).data('correct_text_length',ins_text.length).data('user_response','');this.doTemplate(this.templates.textbox);$e.data('correct',0);var that=this;$e.find('input').die().live('keyup',function(){$e.data('user_response',this.value);});},equals:function(a,b){if(a==b)return true;return false;},restart:function(){this.doTemplate('<%=html%>');this.requestRescore();this.init();},checkAnswers:function(){var $e=$(this.element);if(this.equals($e.data('user_response'),$e.data('correct_text'))){this.doTemplate(this.templates.correct);$e.data('correct',1);}else{this.doTemplate(this.templates.incorrect);$e.data('correct',0);}}},vj_type:{templates:{correct:_tmpl('<%=correct_icon_html%><input type="text" value="<%=correct_text%>" size="<%=correct_text_length%>" />'),incorrect:_tmpl('<%=incorrect_icon_html%><input type="text" value="<%=user_response%>" size="<%=correct_text_length%>" /> <span class="quiet">(La bonne réponse est <%=quoted_correct_text%>)</span>'),textbox:_tmpl('<input type="text" value="<%=user_response%>" size="<%=correct_text_length%>" />')},init:function(){var ins_text=$(this.element).find('ins').eq(0).text();var $e=$(this.element);$e.data('correct_text',ins_text).data('correct_text_length',ins_text.length).data('user_response','').data('quoted_correct_text','« '+ins_text+' »');if(this.options.either_or_separator==undefined){$e.data('quoted_correct_text','« '+ins_text+' »');}else{var sep=this.options.either_or_separator;$e.data('quoted_correct_text','« '+ins_text.split(sep).join('\"'+sep+'\"')+' »');}
this.doTemplate(this.templates.textbox);$e.data('correct',0);var that=this;$e.find('input').die().live('change',function(){$e.data('user_response',this.value);});},equals:function(user_answer,system_answer){if(this.options.ignore_case===true){user_answer=user_answer.toLowerCase();system_answer=system_answer.toLowerCase();}
if(this.options.ignore_whitespace===true){user_answer=user_answer.split(' ').join('');system_answer=system_answer.split(' ').join('');}
if(this.options.either_or_separator!=undefined){var answer_array=system_answer.split(this.options.either_or_separator);for(var i=answer_array.length-1;i>-1;i--){if(answer_array[i]==user_answer){return true;}}}else{if(user_answer==system_answer){return true;}}
return false;},restart:function(){this.doTemplate('<%=html%>');this.requestRescore();this.init();},checkAnswers:function(){var $e=$(this.element);if(this.equals($e.data('user_response'),$e.data('correct_text'))){this.doTemplate(this.templates.correct);$e.data('correct',1);}else{this.doTemplate(this.templates.incorrect);$e.data('correct',0);}}},find:{templates:{hidden:_tmpl('<%=incorrect_text%>'),incorrect:_tmpl('<%=incorrect_icon_html%> <del><%=incorrect_text%></del> <ins><%=correct_text%></ins>'),found:_tmpl('<del><%=incorrect_text%></del> <%=correct_icon_html%><ins><%=correct_text%></ins>')},show:function(){this.doTemplate(this.templates.found);},init:function(){var $e=$(this.element);if($e.data('html')){$e.html($e.data('html'));}
$e.data('incorrect_text',$e.find('del').text()||'').data('correct_text',$e.find('ins').text()||'');var that=this;$e.bind('click submit',function(){that.show();$e.data('correct',1);that.requestRescore();});this.doTemplate(this.templates.hidden);},restart:function(){$(this.element).data('correct',0);this.requestRescore();this.init();},checkAnswers:function(){if($(this.element).data('correct')===0){this.doTemplate(this.templates.incorrect);}}},vj_find_type:{templates:{hidden:_tmpl('<%=incorrect_text%>'),incorrect_unfound:_tmpl('<%=incorrect_icon_html%><del><%=incorrect_text%></del> <span class="quiet">(La bonne réponse est <%=quoted_correct_text%>)</span>'),incorrect_found:_tmpl('<%=correct_icon_html%><del><%=incorrect_text%></del> <%=incorrect_icon_html%><input type="text" value="<%=user_response%>" size="<%=correct_text_length%>" /> <span class="quiet">(La bonne réponse est <%=quoted_correct_text%>)</span>'),correct:_tmpl('<%=correct_icon_html%><del><%=incorrect_text%></del> <%=correct_icon_html%><input type="text" value="<%=correct_text%>" size="<%=correct_text_length%>" />'),incorrect:_tmpl('<%=incorrect_icon_html%><input type="text" value="<%=user_response%>" size="<%=correct_text_length%>" /> <span class="quiet">(La bonne réponse est <%=quoted_correct_text%>)</span>'),found:_tmpl('<%=correct_icon_html%><del><%=incorrect_text%></del> <input type="text" value="<%=user_response%>" size="<%=correct_text_length%>" />')},init:function(){var $e=$(this.element);if($e.data('html')){$e.html($e.data('html'));}
var ins_text=$e.find('ins').text()||'';var del_text=$e.find('del').text()||'';$e.data('correct_text',ins_text).data('incorrect_text',del_text).data('correct_text_length',ins_text.length).data('user_response','').data('found',false).data('total',2).data('quoted_correct_text','« '+ins_text+' »');var that=this;$e.bind('click submit',function(e){e.stopPropagation();that.show();$e.data('found',true);$e.data('correct',1);$e.find('input').focus();that.requestRescore();});$e.find('input').die().live('change',function(){$e.data('user_response',this.value);});this.doTemplate(this.templates.hidden);},show:function(){this.doTemplate(this.templates.found);},restart:function(){$(this.element).data('correct',0);this.requestRescore();this.init();},equals:function(user_answer,system_answer){if(this.options.either_or_separator!=undefined){var answer_array=system_answer.split(this.options.either_or_separator);for(var i=answer_array.length-1;i>-1;i--){if(answer_array[i]==user_answer){return true;}}}else{if(user_answer==system_answer){return true;}}
return false;},checkAnswers:function(){var $e=$(this.element);if($e.data('found')!==true){this.doTemplate(this.templates.incorrect_unfound);$e.data('correct',0);}else if(!this.equals($e.data('user_response'),$e.data('correct_text'))){this.doTemplate(this.templates.incorrect_found);$e.data('correct',1);}else{this.doTemplate(this.templates.correct);$e.data('correct',2);}}},vj_find:{templates:{hidden:_tmpl('<%=incorrect_text%>'),incorrect:_tmpl('<%=incorrect_icon_html%> <del><%=incorrect_text%></del> <ins><%=correct_text%></ins>'),found:_tmpl('<del class="quiet"><%=incorrect_text%></del> <%=correct_icon_html%><ins><%=correct_text%></ins>')},show:function(){this.doTemplate(this.templates.found);},init:function(){var $e=$(this.element);if($e.data('html')){$e.html($e.data('html'));}
$e.data('incorrect_text',$e.find('del').text()||'').data('correct_text',$e.find('ins').text()||'');var that=this;$e.bind('click submit',function(e){e.stopPropagation();that.show();$e.data('correct',1);that.requestRescore();});this.doTemplate(this.templates.hidden);},restart:function(){$(this.element).data('correct',0);this.requestRescore();this.init();},checkAnswers:function(){if($(this.element).data('correct')===0){this.doTemplate(this.templates.incorrect);}}},multiple_choice:{templates:{default_:_tmpl('<select>'+'<% for ( var i = 0; i < answers.length; i+=1 ) {%>'+'<option <%=answers[i].value%> <%=answers[i].selected%>><%=answers[i].text%></option>'+'<% } %>'+'</select>'),correct:_tmpl('<%=correct_icon_html%>'+'<select>'+'<% for ( var i = 0; i < answers.length; i+=1 ) {%>'+'<option <%=answers[i].value%> <%=answers[i].selected%>><%=answers[i].text%></option>'+'<% } %>'+'</select>'),incorrect:_tmpl('<%=incorrect_icon_html%> '+'<select>'+'<% for ( var i = 0; i < answers.length; i+=1 ) {%>'+'<option <%=answers[i].value%> <%=answers[i].selected%>><%=answers[i].text%></option>'+'<% } %>'+'</select> (La bonne réponse est : <%=correct_text%>.)')},onChange:function(){var $e=$(this.element);var answers=$e.data('answers');var sel_index=$e.find('select').get(0).selectedIndex;var len=answers.length;for(var i=0;i<len;i+=1){answers[i].selected=sel_index==i?"selected='selected'":'';}
$e.data('answers',answers).data('selected_index',sel_index).data('correct',0);this.doTemplate(this.templates.default_);this.requestRescore();},init:function(){var answers=[],correct_text='',correct_index=-1;$(this.element).find('ins, del').each(function(index){var $t=$(this);var is_right_answer=$t.is('ins');if(is_right_answer){correct_text=$t.html();correct_index=index;}
answers.push({'text':$t.text(),'value':is_right_answer?'value="true"':'value="false"','selected':''});}).end().data('answers',answers).data('correct',0).data('correct_index',correct_index).data('selected_index',0).data('correct_text',(correct_text?correct_text:''));var that=this;$(this.element).find('select').die().live('change',function(){that.onChange();});this.doTemplate(this.templates.default_);},isCorrect:function(){var d=$(this.element).data();if(d.selected_index===d.correct_index){return true;}
return false;},checkAnswers:function(){if(this.isCorrect()===true){$(this.element).data('correct',1);this.doTemplate(this.templates.correct);}else{$(this.element).data('correct',0);this.doTemplate(this.templates.incorrect);}},restart:function(){this.doTemplate('<%=html%>');this.init();this.requestRescore();}},vj_multiple_choice:{templates:{default_:_tmpl('<select>'+'<% for ( var i = 0; i < answers.length; i+=1 ) {%>'+'<option <%=answers[i].value%> <%=answers[i].selected%>><%=answers[i].text%></option>'+'<% } %>'+'</select>'),correct:_tmpl('<%=correct_icon_html%>'+'<select>'+'<% for ( var i = 0; i < answers.length; i+=1 ) {%>'+'<option <%=answers[i].value%> <%=answers[i].selected%>><%=answers[i].text%></option>'+'<% } %>'+'</select>'),incorrect:_tmpl('<%=incorrect_icon_html%> '+'<select>'+'<% for ( var i = 0; i < answers.length; i+=1 ) {%>'+'<option <%=answers[i].value%> <%=answers[i].selected%>><%=answers[i].text%></option>'+'<% } %>'+'</select> <span class="quiet">(La bonne réponse est « <%=correct_text%> ».)</span>')},onChange:function(){var $e=$(this.element);var answers=$e.data('answers');var sel_index=$e.find('select').get(0).selectedIndex;var len=answers.length;for(var i=0;i<len;i+=1){answers[i].selected=sel_index==i?"selected='selected'":'';}
$e.data('answers',answers).data('selected_index',sel_index).data('correct',0);this.doTemplate(this.templates.default_);this.requestRescore();},init:function(){var answers=[],correct_text='',correct_index=-1;$(this.element).find('ins, del').each(function(index){var $t=$(this);var is_right_answer=$t.is('ins');if(is_right_answer){correct_text=$t.html();correct_index=index;}
answers.push({'text':$t.text(),'value':is_right_answer?'value="true"':'value="false"','selected':''});}).end().data('answers',answers).data('correct',0).data('correct_index',correct_index).data('selected_index',0).data('correct_text',(correct_text?correct_text:''));var that=this;$(this.element).find('select').die().live('change',function(){that.onChange();});this.doTemplate(this.templates.default_);},isCorrect:function(){var d=$(this.element).data();if(d.selected_index===d.correct_index){return true;}
return false;},checkAnswers:function(){if(this.isCorrect()===true){$(this.element).data('correct',1);this.doTemplate(this.templates.correct);}else{$(this.element).data('correct',0);this.doTemplate(this.templates.incorrect);}},restart:function(){this.doTemplate('<%=html%>');this.init();this.requestRescore();}},multiple_choice_radio:{templates:{default_:_tmpl('<div>'+'<% var len = answers.length; for ( var i = 0; i < len; i+=1 ) { var answer = answers[i]; %>'+'<div>'+'<label class="option" for="<%=answer.id%>">'+'<input type="radio" name="<%=answer.group_id%>" <%=answer.value%> id="<%=answer.id%>" <%=answer.selected%> />'+'<%=answer.text%>'+'</label>'+'</div>'+'<% } %>'+'</div>'),correct:_tmpl('<%=correct_icon_html %>'+'<div>'+'<% var len = answers.length; for ( var i = 0; i < len; i+=1 ) { var answer = answers[i]; %>'+'<div>'+'<label class="option" for="<%=answer.id%>">'+'<input type="radio" name="<%=answer.group_id%>" <%=answer.value%> id="<%=answer.id%>" <%=answer.selected%> />'+'<%=answer.text%>'+'</label>'+'</div>'+'<% } %>'+'</div>'),incorrect:_tmpl('<%=incorrect_icon_html %>'+'<div>'+'<% var len = answers.length; for ( var i = 0; i < len; i+=1 ) { var answer = answers[i]; %>'+'<div>'+'<label class="option" for="<%=answer.id%>">'+'<input type="radio" name="<%=answer.group_id%>" <%=answer.value%> id="<%=answer.id%>" <%=answer.selected%> />'+'<%=answer.text%>'+'</label>'+'</div>'+'<% } %>'+'</div>')},getId:function(){return'radio-id-'+$.fn.wordQuestion._getLatestId();},init:function(){var answers=[],correct_text='',correct_id=-1,selected_id=-1,groupId=this.getId(),getId=this.getId;$(this.element).find('ins, del').each(function(index){var $t=$(this);var is_right_answer=$t.is('ins');var my_id=getId();if(is_right_answer){correct_text=$t.html();correct_id=my_id;}
answers.push({'group_id':groupId,'id':my_id,'text':$t.text(),'value':is_right_answer?'value="true"':'value="false"','selected':''});}).end().data('answers',answers).data('correct',0).data('correct_id',correct_id).data('selected_id',selected_id).data('correct_text',correct_text);var that=this;$(this.element).find('input').die().live('click',function(e){if($(this).attr('id')!=$(that.element).data('selected_id')){that.onChange(e);}});this.doTemplate(this.templates.default_);},onChange:function(event){var $e=$(this.element);var answers=$e.data('answers');var selected_id=event.target.id;var index=0;var answers_len=answers.length;while(index<answers_len){var a=answers[index];a.selected=selected_id==a.id?"checked='true'":'';index+=1;}
$e.data('answers',answers).data('selected_id',selected_id).data('correct',0);this.doTemplate(this.templates.default_);this.requestRescore();},isCorrect:function(){var d=$(this.element).data();if(d.selected_id===d.correct_id){return true;}
return false;},checkAnswers:function(){if(this.isCorrect()===true){$(this.element).data('correct',1);this.doTemplate(this.templates.correct);}else{$(this.element).data('correct',0);this.doTemplate(this.templates.incorrect);}},restart:function(){this.doTemplate('<%=html%>');this.init();this.requestRescore();}}};})(jQuery);